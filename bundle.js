!function(){"use strict";const t=2.3283064365386963e-10;class e{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(e){return e=e<1?1/e:e,this._seed=e,this._s0=(e>>>0)*t,e=69069*e+1>>>0,this._s1=e*t,e=69069*e+1>>>0,this._s2=e*t,this._c=1,this}getUniform(){let e=2091639*this._s0+this._c*t;return this._s0=this._s1,this._s1=this._s2,this._c=0|e,this._s2=e-this._c,this._s2}getUniformInt(t,e){let i=Math.max(t,e),o=Math.min(t,e);return Math.floor(this.getUniform()*(i-o+1))+o}getNormal(t=0,e=1){let i,o,s;do{i=2*this.getUniform()-1,o=2*this.getUniform()-1,s=i*i+o*o}while(s>1||0==s);return t+i*Math.sqrt(-2*Math.log(s)/s)*e}getPercentage(){return 1+Math.floor(100*this.getUniform())}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let e=[],i=t.slice();for(;i.length;){let t=i.indexOf(this.getItem(i));e.push(i.splice(t,1)[0])}return e}getWeightedValue(t){let e=0;for(let i in t)e+=t[i];let i,o=this.getUniform()*e,s=0;for(i in t)if(s+=t[i],o<s)return i;return i}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return(new e).setState(this.getState())}}(new e).setSeed(Date.now());class i{getContainer(){return null}setOptions(t){this._options=t}}class o extends i{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const e=`${t.fontStyle?`${t.fontStyle} `:""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=e,this._updateSize(),this._ctx.font=e,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}eventToPosition(t,e){let i=this._ctx.canvas,o=i.getBoundingClientRect();return t-=o.left,e-=o.top,t*=i.width/o.width,e*=i.height/o.height,t<0||e<0||t>=i.width||e>=i.height?[-1,-1]:this._normalizedEventToPosition(t,e)}}class s extends o{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(t,e){let[i,o,s,n,r]=t,l=[(i+1)*this._spacingX,o*this._spacingY+this._hexSize];if(this._options.transpose&&l.reverse(),e&&(this._ctx.fillStyle=r,this._fill(l[0],l[1])),!s)return;this._ctx.fillStyle=n;let a=[].concat(s);for(let t=0;t<a.length;t++)this._ctx.fillText(a[t],l[0],Math.ceil(l[1]))}computeSize(t,e){return this._options.transpose&&(t+=e,t-=e=t-e),[Math.floor(t/this._spacingX)-1,Math.floor((e-2*this._hexSize)/this._spacingY+1)]}computeFontSize(t,e){this._options.transpose&&(t+=e,t-=e=t-e);let i=2*t/((this._options.width+1)*Math.sqrt(3))-1,o=e/(2+1.5*(this._options.height-1)),s=Math.min(i,o),n=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let r=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=n;let l=r/100;s=Math.floor(s)+1;let a=2*s/(this._options.spacing*(1+l/Math.sqrt(3)));return Math.ceil(a)-1}_normalizedEventToPosition(t,e){let i;this._options.transpose?(t+=e,t-=e=t-e,i=this._ctx.canvas.width):i=this._ctx.canvas.height;let o=i/this._options.height;return!function(t,e){return(t%e+e)%e}(e=Math.floor(e/o),2)?t=2*Math.floor(t/(2*this._spacingX)):(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))),[t,e]}_fill(t,e){let i=this._hexSize,o=this._options.border;const s=this._ctx;s.beginPath(),this._options.transpose?(s.moveTo(t-i+o,e),s.lineTo(t-i/2+o,e+this._spacingX-o),s.lineTo(t+i/2-o,e+this._spacingX-o),s.lineTo(t+i-o,e),s.lineTo(t+i/2-o,e-this._spacingX+o),s.lineTo(t-i/2+o,e-this._spacingX+o),s.lineTo(t-i+o,e)):(s.moveTo(t,e-i+o),s.lineTo(t+this._spacingX-o,e-i/2+o),s.lineTo(t+this._spacingX-o,e+i/2-o),s.lineTo(t,e+i-o),s.lineTo(t-this._spacingX+o,e+i/2-o),s.lineTo(t-this._spacingX+o,e-i/2+o),s.lineTo(t,e-i+o)),s.fill()}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);let i,o;this._hexSize=Math.floor(t.spacing*(t.fontSize+e/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,t.transpose?(i="height",o="width"):(i="width",o="height"),this._ctx.canvas[i]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[o]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)}}class n extends o{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(t,e){n.cache?this._drawWithCache(t):this._drawNoCache(t,e)}_drawWithCache(t){let e,[i,o,s,n,r]=t,l=""+s+n+r;if(l in this._canvasCache)e=this._canvasCache[l];else{let t=this._options.border;e=document.createElement("canvas");let i=e.getContext("2d");if(e.width=this._spacingX,e.height=this._spacingY,i.fillStyle=r,i.fillRect(t,t,e.width-t,e.height-t),s){i.fillStyle=n,i.font=this._ctx.font,i.textAlign="center",i.textBaseline="middle";let t=[].concat(s);for(let e=0;e<t.length;e++)i.fillText(t[e],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[l]=e}this._ctx.drawImage(e,i*this._spacingX,o*this._spacingY)}_drawNoCache(t,e){let[i,o,s,n,r]=t;if(e){let t=this._options.border;this._ctx.fillStyle=r,this._ctx.fillRect(i*this._spacingX+t,o*this._spacingY+t,this._spacingX-t,this._spacingY-t)}if(!s)return;this._ctx.fillStyle=n;let l=[].concat(s);for(let t=0;t<l.length;t++)this._ctx.fillText(l[t],(i+.5)*this._spacingX,Math.ceil((o+.5)*this._spacingY))}computeSize(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}computeFontSize(t,e){let i=Math.floor(t/this._options.width),o=Math.floor(e/this._options.height),s=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let n=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=s;let r=n/100*o/i;return r>1&&(o=Math.floor(o/r)),Math.floor(o/this._options.spacing)}_normalizedEventToPosition(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*e),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}n.cache=!1;class r extends o{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(t,e){let[i,o,s,n,r]=t,l=this._options.tileWidth,a=this._options.tileHeight;if(e&&(this._options.tileColorize?this._ctx.clearRect(i*l,o*a,l,a):(this._ctx.fillStyle=r,this._ctx.fillRect(i*l,o*a,l,a))),!s)return;let h=[].concat(s),c=[].concat(n),u=[].concat(r);for(let t=0;t<h.length;t++){let e=this._options.tileMap[h[t]];if(!e)throw new Error(`Char "${h[t]}" not found in tileMap`);if(this._options.tileColorize){let s=this._colorCanvas,n=s.getContext("2d");n.globalCompositeOperation="source-over",n.clearRect(0,0,l,a);let r=c[t],h=u[t];n.drawImage(this._options.tileSet,e[0],e[1],l,a,0,0,l,a),"transparent"!=r&&(n.fillStyle=r,n.globalCompositeOperation="source-atop",n.fillRect(0,0,l,a)),"transparent"!=h&&(n.fillStyle=h,n.globalCompositeOperation="destination-over",n.fillRect(0,0,l,a)),this._ctx.drawImage(s,i*l,o*a,l,a)}else this._ctx.drawImage(this._options.tileSet,e[0],e[1],l,a,i*l,o*a,l,a)}}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight}}function l(t){let e,i;if(t in a)e=a[t];else{if("#"==t.charAt(0)){let i=(t.match(/[0-9a-f]/gi)||[]).map(t=>parseInt(t,16));if(3==i.length)e=i.map(t=>17*t);else{for(let t=0;t<3;t++)i[t+1]+=16*i[t],i.splice(t,1);e=i}}else e=(i=t.match(/rgb\(([0-9, ]+)\)/i))?i[1].split(/\s*,\s*/).map(t=>parseInt(t)):[0,0,0];a[t]=e}return e.slice()}const a={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]};class h extends i{static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(t){alert(t.message)}}schedule(t){requestAnimationFrame(t)}getContainer(){return this._gl.canvas}setOptions(t){super.setOptions(t),this._updateSize();let e=this._options.tileSet;e&&"complete"in e&&!e.complete?e.addEventListener("load",()=>this._updateTexture(e)):this._updateTexture(e)}draw(t,e){const i=this._gl,o=this._options;let[s,n,r,l,a]=t,h=i.canvas.height-(n+1)*o.tileHeight;if(i.scissor(s*o.tileWidth,h,o.tileWidth,o.tileHeight),e&&(o.tileColorize?i.clearColor(0,0,0,0):i.clearColor(..._(a)),i.clear(i.COLOR_BUFFER_BIT)),!r)return;let c=[].concat(r),u=[].concat(a),g=[].concat(l);i.uniform2fv(this._uniforms.targetPosRel,[s,n]);for(let t=0;t<c.length;t++){let e=this._options.tileMap[c[t]];if(!e)throw new Error(`Char "${c[t]}" not found in tileMap`);i.uniform1f(this._uniforms.colorize,o.tileColorize?1:0),i.uniform2fv(this._uniforms.tilesetPosAbs,e),o.tileColorize&&(i.uniform4fv(this._uniforms.tint,_(g[t])),i.uniform4fv(this._uniforms.bg,_(u[t]))),i.drawArrays(i.TRIANGLE_STRIP,0,4)}}clear(){const t=this._gl;t.clearColor(..._(this._options.bg)),t.scissor(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT)}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}eventToPosition(t,e){let i=this._gl.canvas,o=i.getBoundingClientRect();return t-=o.left,e-=o.top,t*=i.width/o.width,e*=i.height/o.height,t<0||e<0||t>=i.width||e>=i.height?[-1,-1]:this._normalizedEventToPosition(t,e)}_initWebGL(){let t=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=t;let e=function(t,e,i){const o=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(o,e),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(o)||"");const s=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(s,i),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(s)||"");const n=t.createProgram();if(t.attachShader(n,o),t.attachShader(n,s),t.linkProgram(n),!t.getProgramParameter(n,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(n)||"");return n}(t,u,g);return t.useProgram(e),function(t){const e=new Float32Array([0,0,1,0,0,1,1,1]),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0)}(t),c.forEach(i=>this._uniforms[i]=t.getUniformLocation(e,i)),this._program=e,t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.SCISSOR_TEST),t}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._gl,e=this._options,i=[e.width*e.tileWidth,e.height*e.tileHeight];t.canvas.width=i[0],t.canvas.height=i[1],t.viewport(0,0,i[0],i[1]),t.uniform2fv(this._uniforms.tileSize,[e.tileWidth,e.tileHeight]),t.uniform2fv(this._uniforms.targetSize,i)}_updateTexture(t){!function(t,e){let i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)}(this._gl,t)}}const c=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],u="\n#version 300 es\n\nin vec2 tilePosRel;\nout vec2 tilesetPosPx;\n\nuniform vec2 tilesetPosAbs;\nuniform vec2 tileSize;\nuniform vec2 targetSize;\nuniform vec2 targetPosRel;\n\nvoid main() {\n\tvec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;\n\tvec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;\n\ttargetPosNdc.y *= -1.0;\n\n\tgl_Position = vec4(targetPosNdc, 0.0, 1.0);\n\ttilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;\n}".trim(),g="\n#version 300 es\nprecision highp float;\n\nin vec2 tilesetPosPx;\nout vec4 fragColor;\nuniform sampler2D image;\nuniform bool colorize;\nuniform vec4 bg;\nuniform vec4 tint;\n\nvoid main() {\n\tfragColor = vec4(0, 0, 0, 1);\n\n\tvec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);\n\n\tif (colorize) {\n\t\ttexel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;\n\t\tfragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;\n\t\tfragColor.a = texel.a + (1.0-texel.a)*bg.a;\n\t} else {\n\t\tfragColor = texel;\n\t}\n}".trim();let f={};function _(t){if(!(t in f)){let e;if("transparent"==t)e=[0,0,0,0];else if(t.indexOf("rgba")>-1){e=(t.match(/[\d.]+/g)||[]).map(Number);for(let t=0;t<3;t++)e[t]=e[t]/255}else e=l(t).map(t=>t/255),e.push(1);f[t]=e}return f[t]}function d(t){let e=l(t);return 36*Math.floor(e[0]*(6/256))+6*Math.floor(e[1]*(6/256))+1*Math.floor(e[2]*(6/256))+16}class p extends i{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(t){setTimeout(t,1e3/60)}setOptions(t){super.setOptions(t);let e=[t.width,t.height],i=this.computeSize();this._offset=i.map((t,i)=>Math.floor((t-e[i])/2))}clear(){process.stdout.write(`[0;48;5;${d(this._options.bg)}m[2J`)}draw(t,e){let[i,o,s,n,r]=t,l=this._offset[0]+i,a=this._offset[1]+o,h=this.computeSize();if(l<0||l>=h[0])return;if(a<0||a>=h[1])return;if(l===this._cursor[0]&&a===this._cursor[1]||(process.stdout.write(function(t,e){return`[${e+1};${t+1}H`}(l,a)),this._cursor[0]=l,this._cursor[1]=a),e&&(s||(s=" ")),!s)return;let c=function(t,e){return`[0;38;5;${d(t)};48;5;${d(e)}m`}(n,r);c!==this._lastColor&&(process.stdout.write(c),this._lastColor=c);let u=[].concat(s);process.stdout.write(u[0]),this._cursor[0]++,this._cursor[0]>=h[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(t,e){return[t,e]}computeSize(){return[process.stdout.columns,process.stdout.rows]}}const m=/%([bc]){([^}]*)}/g;function w(t,e){let i=[],o=0;t.replace(m,(function(e,s,n,r){let l=t.substring(o,r);return l.length&&i.push({type:0,value:l}),i.push({type:"c"==s?2:3,value:n.trim()}),o=r+e.length,""}));let s=t.substring(o);return s.length&&i.push({type:0,value:s}),function(t,e){e||(e=1/0);let i=0,o=0,s=-1;for(;i<t.length;){let n=t[i];if(1==n.type&&(o=0,s=-1),0!=n.type){i++;continue}for(;0==o&&" "==n.value.charAt(0);)n.value=n.value.substring(1);let r=n.value.indexOf("\n");if(-1!=r){n.value=v(t,i,r,!0);let e=n.value.split("");for(;e.length&&" "==e[e.length-1];)e.pop();n.value=e.join("")}if(n.value.length){if(o+n.value.length>e){let r=-1;for(;;){let t=n.value.indexOf(" ",r+1);if(-1==t)break;if(o+t>e)break;r=t}if(-1!=r)n.value=v(t,i,r,!0);else if(-1!=s){let e=t[s],o=e.value.lastIndexOf(" ");e.value=v(t,s,o,!0),i=s}else n.value=v(t,i,e-o,!1)}else o+=n.value.length,-1!=n.value.indexOf(" ")&&(s=i);i++}else t.splice(i,1)}t.push({type:1});let n=null;for(let e=0;e<t.length;e++){let i=t[e];switch(i.type){case 0:n=i;break;case 1:if(n){let t=n.value.split("");for(;t.length&&" "==t[t.length-1];)t.pop();n.value=t.join("")}n=null}}return t.pop(),t}(i,e)}function v(t,e,i,o){let s={type:1},n={type:0,value:t[e].value.substring(i+(o?1:0))};return t.splice(e+1,0,s,n),t[e].value.substring(0,i)}const x={hex:s,rect:n,tile:r,"tile-gl":h,term:p},S={width:80,height:25,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};class b{constructor(t={}){this._data={},this._dirty=!1,this._options={},t=Object.assign({},S,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(t,e,i){let o=[this._options.bg,this._options.fg];this.draw(t,e,null,null,o[i%o.length])}clear(){this._data={},this._dirty=!0}setOptions(t){if(Object.assign(this._options,t),t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){if(t.layout){let e=x[t.layout];this._backend=new e}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(t,e){return this._backend.computeSize(t,e)}computeFontSize(t,e){return this._backend.computeFontSize(t,e)}computeTileSize(t,e){return[Math.floor(t/this._options.width),Math.floor(e/this._options.height)]}eventToPosition(t){let e,i;return"touches"in t?(e=t.touches[0].clientX,i=t.touches[0].clientY):(e=t.clientX,i=t.clientY),this._backend.eventToPosition(e,i)}draw(t,e,i,o,s){o||(o=this._options.fg),s||(s=this._options.bg);let n=`${t},${e}`;this._data[n]=[t,e,i,o,s],!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[n]=!0)}drawText(t,e,i,o){let s=null,n=null,r=t,l=e,a=1;o||(o=this._options.width-t);let h=w(i,o);for(;h.length;){let e=h.shift();switch(e.type){case 0:let i=!1,o=!1,h=!1,c=!1;for(let t=0;t<e.value.length;t++){let a=e.value.charCodeAt(t),u=e.value.charAt(t);h=a>65280&&a<65377||a>65500&&a<65512||a>65518,i=32==u.charCodeAt(0)||12288==u.charCodeAt(0),!c||h||i||r++,h&&!o&&r++,this.draw(r++,l,u,s,n),o=i,c=h}break;case 2:s=e.value||null;break;case 3:n=e.value||null;break;case 1:r=t,l++,a++}}return a}_tick(){if(this._backend.schedule(this._tick),this._dirty){if(!0===this._dirty){this._backend.clear();for(let t in this._data)this._draw(t,!1)}else for(let t in this._dirty)this._draw(t,!0);this._dirty=!1}}_draw(t,e){let i=this._data[t];i[4]!=this._options.bg&&(e=!0),this._backend.draw(i,e)}}b.Rect=n,b.Hex=s,b.Tile=r,b.TileGL=h,b.Term=p;var y=function(t,e,i){return e<i?t<e?e:t>i?i:t:t<i?i:t>e?e:t};var T=8603928,M=9210666,E=4032806,P=5221938,C=16711422;const k=Math.PI/2;var z={"☺":1,"☻":2,"♥":3,"♦":4,"♣":5,"♠":6,"•":7,"◘":8,"○":9,"◙":10,"♂":11,"♀":12,"♪":13,"♫":14,"☼":15,"▶":16,"◀":17,"↕":18,"‼":19,"¶":20,"§":21,"▬":22,"↨":23,"↑":24,"↓":25,"→":26,"←":27,"∟":28,"↔":29,"▲":30,"▼":31," ":32,"!":33,'"':34,"#":35,$:36,"%":37,"&":38,"'":39,"(":40,")":41,"*":42,"+":43,",":44,"-":45,".":46,"/":47,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,":":58,";":59,"<":60,"=":61,">":62,"?":63,"@":64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"[":91,"\\":92,"]":93,"^":94,_:95,"`":96,a:97,b:98,c:99,d:100,e:101,f:102,g:103,h:104,i:105,j:106,k:107,l:108,m:109,n:110,o:111,p:112,q:113,r:114,s:115,t:116,u:117,v:118,w:119,x:120,y:121,z:122,"{":123,"|":124,"}":125,"~":126,"⌂":127,"Ç":128,"ü":129,"é":130,"â":131,"ä":132,"à":133,"å":134,"ç":135,"ê":136,"ë":137,"è":138,"ï":139,"î":140,"ì":141,"Ä":142,"Å":143,"É":144,"æ":145,"Æ":146,"ô":147,"ö":148,"ò":149,"û":150,"ù":151,"ÿ":152,"Ö":153,"Ü":154,"¢":155,"£":156,"¥":157,"₧":158,"ƒ":159,"á":160,"í":161,"ó":162,"ú":163,"ñ":164,"Ñ":165,"ª":166,"º":167,"¿":168,"⌐":169,"¬":170,"½":171,"¼":172,"¡":173,"«":174,"»":175,"░":176,"▒":177,"▓":178,"│":179,"┤":180,"╡":181,"╢":182,"╖":183,"╕":184,"╣":185,"║":186,"╗":187,"╝":188,"╜":189,"╛":190,"┐":191,"└":192,"┴":193,"┬":194,"├":195,"─":196,"┼":197,"╞":198,"╟":199,"╚":200,"╔":201,"╩":202,"╦":203,"╠":204,"═":205,"╬":206,"╧":207,"╨":208,"╤":209,"╥":210,"╙":211,"╘":212,"╒":213,"╓":214,"╫":215,"╪":216,"┘":217,"┌":218,"█":219,"▄":220,"▌":221,"▐":222,"▀":223,"α":224,"ß":225,"Γ":226,"π":227,"Σ":228,"σ":229,"µ":230,"τ":231,"Φ":232,"Θ":233,"Ω":234,"δ":235,"∞":236,"φ":237,"ε":238,"∩":239,"≡":240,"±":241,"≥":242,"≤":243,"⌠":244,"⌡":245,"÷":246,"≈":247,"°":248,"∙":249,"·":250,"√":251,"ⁿ":252,"²":253,"■":254};const R={columns:0,rows:0,font:{width:0,height:0},listItems:[],animations:[],movePaths:[],consoles:[{parentConsole:-1,layout:{width:40,height:1,left:4,top:4}}],texts:[]},A=[{life:{type:"CONST",factor:400},colorMOD:{effect:"ALPHA+",color:X(C),efactor:1,rate:"SIN-"}}];function O(t,e,i){return e.map((e,o)=>Math.round(i*e+(1-i)*t[o]))}function X(t){return[t>>16,t>>8&255,255&t]}let I,U,F;function N(t,e,i,o,s){const n=i.split("\n");let r=e;for(const e of n){for(let i=0;i<e.length;i++)U.draw(t+i,r,e[i],o,s);r++}}function W(){const t=performance.now();for(let e=R.movePaths.length-1;e>=0;e--){const i=R.movePaths[e];let o=t-I;if(i.delayStart>0&&(i.delayStart-=o,o=i.delayStart<0?-i.delayStart:0),o>0){i.accum+=o,i.ttl-=o;const t=R.consoles[i.console];for(;i.accum>=i.msPerPathSegment;){i.accum-=i.msPerPathSegment;const e=i.path.shift();if(!e)break;t.layout.left+=e[0],t.layout.top+=e[1]}}if(i.ttl<=0){const t=[];R.texts.forEach((function(e,o){e.console===i.console&&t.push(o)}));for(const e of t)R.animations.push({type:0,text:e,accum:0});R.movePaths.splice(e,1)}}for(let i=R.animations.length-1;i>=0;i--){const o=R.animations[i];let s=t-I;o.accum+=s;const n=A[o.type];if("ALPHA+"===n.colorMOD.effect){let t;"SIN-"===n.colorMOD.rate?(e=y(o.accum/n.life.factor,0,1),t=Math.sin(k+k*e)):"LINEAR"===n.colorMOD.rate&&(t=1-y(o.accum/n.life.factor,0,1));const i=R.texts[o.text];i.originalColor||(i.originalColor=i.color);const s=n.colorMOD.color,r=i.originalColor;i.color=O(r,s,t)}"CONST"===n.life.type&&o.accum>=n.life.factor&&R.animations.splice(i,1)}var e;!function(){U.clear();for(const t of R.texts){let e=0,i=0,o=R.consoles[t.console];for(;o;)e+=o.layout.left,i+=o.layout.top,o=o.parentConsole>=0?R.consoles[o.parentConsole]:void 0;if(void 0!==t.layout.left)e+=t.layout.left;else if(void 0!==t.layout.right){e+=R.consoles[t.console].layout.width-t.text.length-t.layout.right}i+=t.layout.top;const s=`rgb(${t.color[0]}, ${t.color[1]}, ${t.color[2]})`;N(e,i,t.text,s,t.bkgColor)}}(),I=t,requestAnimationFrame(W)}!function(t){for(let e=0;e<t;e++){const t={parentConsole:0,layout:{width:45,height:1,left:0,top:e}};R.consoles.push(t);const i=R.consoles.length-1;R.listItems.push({console:i,sortValue:1}),R.texts.push({console:i,text:"█ HERE IS SOME TEXT!"+Math.round(1e3*Math.random()),bkgColor:"black",color:X(P),layout:{left:0,top:0}});const o=[M,E,T];R.texts.push({console:i,text:"|||||||",bkgColor:"black",color:X(o[Math.floor(Math.random()*o.length)]),layout:{right:10,top:0}})}}(60),function({width:t,height:e}){R.font.width=t,R.font.height=e,R.columns=Math.ceil(window.outerWidth/t),R.rows=Math.ceil(window.outerHeight/e);const i=new Image;i.src=`/font/font_${R.font.width}_${R.font.height}.png`,i.onload=t=>{for(const t in z){const e=z[t],i=e%32*R.font.width,o=(e/32|0)*R.font.height;z[t]=[i,o]}U=new b({bg:"black",layout:"tile-gl",tileColorize:!0,tileWidth:R.font.width,tileHeight:R.font.height,tileSet:i,tileMap:z,width:R.columns,height:R.rows}),F=U.getContainer(),F.style.imageRendering="pixelated",document.body.appendChild(F),I=performance.now(),W()}}({width:8,height:10}),window.shuffle=function(){for(const t of R.listItems)Math.random()<.2&&(t.weight=Math.round(200*Math.random()));R.listItems.sort((t,e)=>t.weight>e.weight?1:t.weight<e.weight?-1:0),R.listItems.forEach((t,e)=>{const i=R.consoles[t.console].layout.top;if(i===e)return;const o=function(t,e){const i=e>t?1:-1,o=Math.abs(e-t),s=Math.floor(o/2)+1,n=[];for(let t=1;t<=s;t++)n.push([-1,0]);for(let t=1;t<=o;t++)n.push([0,i]);for(let t=s;t>0;t--)n.push([1,0]);return n}(i,e),s=Math.floor(300/o.length);R.movePaths.push({console:t.console,path:o,msPerPathSegment:s,delayStart:Math.round(700*Math.random()),accum:0,ttl:300})})}}();
